apiVersion: v1
kind: Namespace
metadata:
  name: kube-glusterfs
---
kind: Service
apiVersion: v1
metadata:
  name: heketi
  namespace: kube-glusterfs
spec:
  type: NodePort
  selector:
    app: heketi
  ports:
  - name: heketi
    port: 8080
    targetPort: 8080
---
apiVersion: v1
kind: Secret
metadata:
  name: heketi-secret
  namespace: kube-glusterfs
data:
  key: cGFzc3dvcmQ=
type: kubernetes.io/glusterfs
---
apiVersion: v1
kind: Secret
metadata:
  name: heketi-ssh-key
  namespace: kube-glusterfs
type: Opaque
data:
  id_rsa: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlHNGdJQkFBS0NBWUVBcVFMTWl5YzY3RmhZdXVhamgxQVRSTFBZdUp5N29adThRbXdZS2NTamdGY0FvVDlECnphcXA3dUUrZGcxN1FQTDRwdllFT2lWVGhYZ0JDcU1ieHVJWkQ1aFJmZkdqNVBMYWM5RThwdlpQVU1waXh6VFoKUnZlc3M4NmFwUzdqT0xNNXYvbHRFeVR6S0llUFlzZzROaGZMMGZZSFQ2MnAxQVFWbnQxTnZBMHpqcll1elBUQgpBZFkwcjVnNDJRRVJzRXFvclBHQ2ZTSnhELzVMSEd2RzBzSjdtemhxOVBaQ2FYbGtrcGtDZEtrdXFyb2JHbG4wCjVvbEdhdnhQVWJnam9SbmtJcUJTQTFIbXdTdU00d0dOVHZ3dEw2U3hRczg0TGVjVk1Ocmd6WjlZN3pERnJTR2gKcWZJd0RvQzAxR3NCdHVKQUUyaHoyaVdUN0ExbUZjbTBOaGNDREExbUY4VjVleFJSNmN1NFlqREZRanc4b09LcApJNWJta01wVVRySm9zc28vajRXODRDQVBGbjZvMXdjTXR6OE01LytXTkF4WGZqUEJ6M0h6NHA5NVp5R1JjR2lRClRxcDRtYmN1TkxRenRGQjJGbkIvQUVDZFZnZk1paHd1MmtUUUZQcGhmeC8zZnJyU0t3Y1J5THorTk8xclNtOTYKOXBKOUZNTGdzV1ZwL1RjaEFnTUJBQUVDZ2dHQUVMbDlicmE4MnJiNlh0SmtjOGN0aFBLc0cwYXRQWmFJNkdURQpkbHVtVjFTa3RCQXI0RDRIYjJOY09EZm96cnBNZDA4b2gyMTZxSjVCc2lFR1ptV28xN1Y1dVBZUXd4N3lGWnhxCnZWWHA3dU44SjF6WU5IRGRadlNtc25wamsxQ1BBaXVIU3VudzR2MlpKNHdMSGZVNFh1aFMvR1JCeGtCNk9EeUwKalBTY2ViNlcvb0tvMThydjcwRm52TGVobmJtaG0rMlJQVnRMWjJzQldVaGtCaWFuTHlyRDBNWk90NXZDNDB2ZgpaWlo1VHYwNEllRXRmaU91ODNiUXpaUWtlSFIwaVBYMlU2SXVEYVNJVCt5bjlUNzExSFFuakJobXY2QUxLUml1ClZ5cXVmSTNFb0ovR1cycCtwQmlFV054dGl2d0tYRFlrRFZwTUpwTWhqY3BQZG5FTHBuT2orY1hxTUYxSEttWUkKZmlNbDB3WmZCRXJQSnZtcE1MUE9hUVB2Z2hhdVJtTzZKaVRNcTBCbm80bVVDYzB5c2dGQVlORmRLc1U2RVVoYgpuRldWTElldmpRWFk1UnhvWTZoQU5Sd1kvQ0M5WVMyelptNkJsb0YxZUttcUZnSjhvZzNucWlobFhqQUJoZHVaCjNobUJFclRwK3BiN21VazFQUldmY3BSM3hkMXhBb0hCQU5aa1hSK1UyTDg4TGJ4WXBiczJlK1o1MC9YRlVzaVgKMTJyKzFLdHlST2lacXlJYUI2ajVQRm9rSU1kVVVhUy95ellCV1NEazdEWXFNU3FYUWVxdXlYYnd0RjZIZHBOQgpvTjJpYWVkWEI1R0o3c2habXE1MWY4WjJMblNYbC9kSW43Q21sZmQ5dm14bUYwYllBWUhTYTNHMDl5OFB1aEhUCjN2RnZjaVpYSkt0NmJEcjh4Y0xxSU1PaGszU2JBcG55Q3N0dnA4YlJ2cHJ5cFliT0xsOVRDell5d3pXTSs5bEsKd25qZkw0VzNrRGcxZ1ZWelNhWnVSK2Rpc3lZT2p4SnZ5UUtCd1FESno4UW5xZGZZbWlpVzZtKzN2SWdSZXRiUgpPdG1wTnA0c1Z6K3o0bU1TeVorZFpoK09wQzNNRDBVM1V6U2I0R0lCaUE0UUEwMWVkZmQ0YTl5UEd1TXdwZzZ5CjE0U2k1d0orMndzY1JsTjg2eHNWNEJIVXl5N3dsRThIMVBIeTgwUW1SOGxqdklEMWh6cWRIT1I5UDRnVS8rUXEKYUp0bnBFK3RiZ3h1S2xTTkNoZ1Z5OS9uTVBQK1hMNEpNOUxDdWkwMEM3NExZVmx2azViUm1mQytMNUh5YUNRdQpidW1WWUhEakFwVHFBSW16R1h5ZEFpOXRhMDlFbkpvTkErejVLSmtDZ2NBckVzais0bG5WdWhKNlI5a3NUdHIvCnlEUkVxWnRqUDlhQTRhZjZ0aCtRRitlaEYxZTRwREp5N2RWRUZ2VzhRdWhoOWsxZzVYMXJ1SGhlVlR0aUdqSFIKMnJSeVZZY0dPT1pJQVN5RDFTRnBKU3c3Um4xa1Zha1JSNGMzMTRrcG5vYXU2Qmt6T3lrNkFCem5GOWpkcTFmNAo1V0hRSzdtM2dUakdpeHlGQlhjUm1Ld01BZUw5c1NwYUE2bHJnUVU1eHI1U2R5RmZPWjZ3NU5WS3l6dlgzUWhnCm9EeEdFd2c2ZE9HemhTdTRFdFEvNXNnUVVmUlhJc3NCZXZ3QlJtV0tUN2tDZ2NBa1ozUXM2M2hpUER6Q0xId0cKbXQyNHVYM3l0RGo3U3p6eEpyUDVFUWRxSmpEQ3hkOC9iZUpOQXh3clJMa2l2VEV3c1loSDN6Q2ZyNHY2andwMApUaGRaZVRzQmk5c0RQOFMxZVhIaG9kWUJuSytBSExGYXYyUXlSYTZUN1JmUUNZM3JrZHVFUUViTEE1L1JJNXNiCjlNL3BhZGVReHRueHNqUWxSc3E3UEt1UDNaaEdwa1kzZ0I4amJUdGlrWlNkUjlSTHBTcWRCdXlKTWdoc3V1WXcKaUlnOVFBZjIwRThXZ1JVYi9pVTZxT291QXBUMkJhVGtpZ3o4aFh0TWliNi9tMUVDZ2NBbjlOR0Ivdjc2cXh5WQpTZHhPYWM3RTYxK0hhcnkwZVZBQndKSHZlWitpU1ViUFNZT1BwZEZSQmtPSS9MdTUvblRhS0UzZnZzRHlhUmpYCjBHMVFsTDFFc0NXWk9iTVZXYVpjdDMwWVBGMFN4VHVEOW5kQy9pNUhhd2dBNzhFekQ2MXdlNGJZQXJSMlkrVWYKdENUMGo3QVFGSWt4aHIzNDZBUFhnemNCempkWXZXVnlqNlpFdmlCNHB2N0JYVzZFbTlWdm5ZRytPSmV6bUw1RQpibmgzY2k3RHJ5SHY0MUlJdERId2hUSGZDK0xqa0k3ZzdXVVZFc0g2b0JlTFJLWFNoWDQ9Ci0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg==
---
kind: Deployment
apiVersion: apps/v1
metadata:
  name: heketi
  namespace: kube-glusterfs
spec:
  selector:
    matchLabels:
      app: heketi
  replicas: 1
  strategy:
    type: Recreate
  template:
    metadata:
      name: heketi
      labels:
        app: heketi
    spec:
      terminationGracePeriodSeconds: 0
      containers:
      - image: heketi/heketi:10
        imagePullPolicy: Always
        name: heketi
        env:
        - name: HEKETI_EXECUTOR
          value: ssh
        - name: HEKETI_SSH_USER
          value: root
        - name: HEKETI_SSH_PORT
          value: '22'
        - name: HEKETI_SSH_KEYFILE
          value: "/root/.ssh/id_rsa"
        - name: HEKETI_ADMIN_KEY
          valueFrom:
            secretKeyRef:
              name: heketi-secret
              key: key
        ports:
        - containerPort: 8080
        volumeMounts:
        - name: heketi-ssh-key
          mountPath: "/root/.ssh"
        - name: heketi-db
          mountPath: "/var/lib/heketi"
        readinessProbe:
          timeoutSeconds: 3
          initialDelaySeconds: 3
          httpGet:
            path: "/hello"
            port: 8080
        livenessProbe:
          timeoutSeconds: 3
          initialDelaySeconds: 15
          httpGet:
            path: "/hello"
            port: 8080
      volumes:
      - name: heketi-ssh-key
        secret:
          secretName: heketi-ssh-key
          defaultMode: 0400
      - name: heketi-db
        emptyDir:
          medium: "Memory"
          sizeLimit: "1Gi"